<!DOCTYPE html>
<html>
  <head>
    <title>Compass Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">

    /*// The watch id references the current `watchHeading`
    var watchID = null;

    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // device APIs are available
    //
    function onDeviceReady() {
        startWatch();
    }

    // Start watching the compass
    //
    function startWatch() {

        // Update compass every 3 seconds
        var options = { frequency: 3000 };

        watchID = navigator.compass.watchHeading(onSuccess, onError, options);
    }

    // Stop watching the compass
    //
    function stopWatch() {
        if (watchID) {
            navigator.compass.clearWatch(watchID);
            watchID = null;
        }
    }

    // onSuccess: Get the current heading
    //
    function onSuccess(heading) {
        var element = document.getElementById('heading');
        element.innerHTML = 'Heading: ' + heading.magneticHeading;
        var needle = document.querySelector('.needle');
        needle.style.webkitTransform = 'rotate('+rotation+')';
    }

    // onError: Failed to get the heading
    //
    function onError(compassError) {
        alert('Compass error: ' + compassError.code);
    }
    */

 document.addEventListener('deviceready', function(){
    var watchId = null;
    var start = document.querySelector('.start');
    start.addEventListener('click', function(){
        var options = null;
        //if(watchId==null){
                options = {
                    frequency: 200
                }
                navigator.compass.watchHeading(
                    function(heading){
                        var element = document.getElementById('heading');
                        element.innerHTML = 'Heading: ' + heading.magneticHeading;
                        var rotation = Math.round(heading.magneticHeading)+'deg';
                        var needle = document.querySelector('.needle');
                        needle.style.webkitTransform = 'rotate('+rotation+')';
                    }, 
                    function(error){
                        console.log("error");
                    }, 
                    options
                );
       // }
    });
 
 });
   var stop = document.querySelector('.stop');
    stop.addEventListener('click', function(){
        navigator.compass.clearWatch(watchId);
        watchId = null;
    });
    </script>
  </head>
  <body>
 
 <div id="heading">Waiting for heading...</div>
    <button class="start" >Start Watching</button>
    <button class="stop">Stop Watching</button>

        <!--div id="heading">Waiting for heading...</div>
    <button onclick="startWatch();">Start Watching</button>
    <button onclick="stopWatch();">Stop Watching</button-->

    <div class="compass">
            <img  class="compass-img" src="compass.png" width="240" height="239">
            <img class="needle" src="needle.png" width="40" height="170">           
        </div>
  </body>
</html>
<style type="text/css">
    .compass{
        max-height: 320px;
        margin: 0 auto;
    }
</style>
